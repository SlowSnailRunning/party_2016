<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>当前考试</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="../../layui/css/layui.css" media="all"/>
    <link rel="stylesheet" href="../../css/public.css" media="all"/>
    <script type="text/javascript" src="../../layui/layui.js"></script>
    <script type="text/javascript" src="../../js/jquery-3.3.1.js"></script>
</head>
<body class="childrenBody" id="time">


<form class="layui-form layui-row layui-col-space10">
    <div class="layui-col-md9 layui-col-xs12">
        <div class="layui-row layui-col-space10">
            <div class="layui-col-md9 layui-col-xs7">

                <!--the id of student in db.-->
                <input type="text" class="layui-input layui-hide id" name="id">

                <div class="layui-form-item magt3">
                    <label class="layui-form-label">考试名:</label>
                    <div class="layui-input-block">
                        <input type="text" class="layui-input examName layui-disabled" disabled name="examName" required lay-verify="required">
                    </div>
                </div>


                <div class="layui-form-item magt3">
                    <label class="layui-form-label">考试时长:</label>
                    <div class="layui-input-block">
                        <input type="text" name="examTime" class="layui-input examTime layui-disabled" disabled required lay-verify="required">
                    </div>
                </div>

                <div class="layui-form-item magt3">
                    <label class="layui-form-label">考试状态:</label>
                    <div class="layui-input-block">
                        <input type="text" name="examStatus" id="examStatus" class="layui-input examStatus layui-disabled" disabled required
                               lay-verify="required">
                    </div>
                </div>
                <div class="layui-form-item magt3">
                    <label class="layui-form-label">考试剩余时间:</label>
                    <div class="layui-input-block">
                        <div id="remainTime" style="font-size:18px;font-weight:600;color:#FF5722;line-height: 36px"></div>
                    </div>
                </div>


                <div class="layui-form-item magt3">
                    <label class="layui-form-label">及格分数:</label>
                    <div class="layui-input-block">
                        <input type="text" name="passScore" class="layui-input passScore layui-disabled" disabled required
                               lay-verify="required">
                    </div>
                </div>
                <div class="layui-form-item magt3">
                    <label class="layui-form-label">开闭卷:</label>
                    <div class="layui-input-block">
                        <input type="text" name="openOrClose" class="layui-input openOrClose layui-disabled" disabled required
                               lay-verify="required">
                    </div>
                </div>
                <br>
                在线人数:<span id="peopel">430</span><br>

            </div>
        </div>

    </div>
</form>
<script>
    layui.use(['layer','element','jquery','form','util', 'laydate'],function () {
        var $,element,form,util,laydate,layer;
        util = layui.util;
        laydate = layui.laydate;
        form =layui.form;
        layer = layui.layer;
        $=layui.jquery;
        element = layui.element;
        $(function(){
            function loadexamCurrent(){
                $.ajax({
                    type:"POST",
                    url:'/exam/queryCurrentExamInformation.do',
                    data:{},
                    dataType:'json',
                    contentType: "application/json;charset=utf-8;",
                    success:function(res){
                        if(res && res.code===0){
                            var menuHtml="";
                            var obj = eval("("+JSON.stringify(res.data)+")");

                            $('.examName').val(obj[0].examName);
                            $('.examTime').val(obj[0].examTime+"分钟");

                            $('.examStatus').val('正在考试...');
                            $('.examStatus').css('color','red')
                            $('.passScore').val(obj[0].passScore+"分");
                            $('.residualTime').val(layui.util.toDateString(obj[0].examEndTime, 'yyyy-MM-dd HH:mm:ss'));
                            $('.test1').val(layui.util.toDateString(obj[0].examEndTime, 'yyyy-MM-dd HH:mm:ss'));


                            /*0：闭卷 ； 1：开卷*/
                            if(obj[0].openOrClose === 0){
                                $('.openOrClose').val('闭卷');
                            }
                            if(obj[0].openOrClose !== 0){
                                $('.openOrClose').val("开卷");
                            }

                          /*  var examEndTime = layui.util.toDateString(obj[0].examEndTime, 'yyyy-MM-dd HH:mm:ss');
                            var TimebeforeAndafter=new Array(examEndTime.split(" "));
                            var Timebefore = new Array(TimebeforeAndafter[0].split("-"));
                            var Timeafter =new Array(TimebeforeAndafter[1].split(":"));
                            var y =parseInt(Timebefore[0]);
                            var M =parseInt(Timebefore[1]-1);
                            var d =parseInt(Timebefore[2]);
                            var H =parseInt(Timeafter[0]);
                            var m =parseInt(Timeafter[1]);
                            var s =parseInt(Timeafter[2]);*/
                            /*setCountdown(y,M,d,H,m,s);*/

                         /*   alert(layui.util.toDateString(obj[0].examEndTime, 'yyyy-MM-dd HH:mm:ss'));*/


                            /*-----------倒计时----------------*/
                            var SysSecond;
                            var InterValObj;

                            $(document).ready(function() {
                                SysSecond = parseInt((obj[0].examEndTime - new Date())/1000); //这里获取倒计时的起始时间
                                InterValObj = window.setInterval(SetRemainTime, 1000); //间隔函数，1秒执行
                            });

                            //将时间减去1秒，计算天、时、分、秒
                            function SetRemainTime() {
                                if (SysSecond > 0) {
                                    SysSecond = SysSecond - 1;
                                    var second = Math.floor(SysSecond % 60);            // 计算秒
                                    var minite = Math.floor((SysSecond / 60) % 60);      //计算分
                                    var hour = Math.floor((SysSecond / 3600) % 24);      //计算小时
                                    var day = Math.floor((SysSecond / 3600) / 24);       //计算天

                                    var hourDiv = "<span id='hourSpan'>"+ hour + "小时"+"</span>";
                                    var dayDiv = "<span id='daySpan'>"+ day + "天"+"</span>";

                                    $("#remainTime").html(dayDiv + hourDiv + minite + "分" + second + "秒");

                                    if(hour === 0) {//当不足1小时时隐藏小时
                                        $('#hourSpan').css('display','none');
                                    }
                                    if(day === 0) {//当不足1天时隐藏天
                                        $('#daySpan').css('display','none');
                                    }

                                } else {//剩余时间小于或等于0的时候，就停止间隔函数
                                    window.clearInterval(InterValObj);
                                    //这里可以添加倒计时时间为0后需要执行的事件
                                    layer.alert("考试时间到！");
                                }
                            }


                        }
                    }
                })
            };
            loadexamCurrent();

            var setInt=setInterval(function () {
                $.ajax({
                    url : "/exam/studentSize.do",
                    type : "get",
                    success : function(data){
                        $("#peopel").text(data);
                    }
                });
            },2000);
        })
    });

   /* .val(layui.util.toDateString(original_data.examEndTime, 'yyyy-MM-dd HH:mm:ss'));*/

</script>

<script type="text/javascript" src="http://apps.bdimg.com/libs/jquery/1.9.1/jquery.min.js"></script>


</body>
</html>