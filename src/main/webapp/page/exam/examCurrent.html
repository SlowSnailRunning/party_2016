<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>当前考试</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="../../layui/css/layui.css" media="all"/>
    <link rel="stylesheet" href="../../css/public.css" media="all"/>
    <script type="text/javascript" src="../../layui/layui.js"></script>
    <script type="text/javascript" src="../../js/jquery-3.3.1.js"></script>
</head>
<body class="childrenBody" id="time">


<form class="layui-form layui-row layui-col-space10">
    <div class="layui-col-md9 layui-col-xs12">
        <div class="layui-row layui-col-space10">
            <div class="layui-col-md9 layui-col-xs7">

                <!--the id of student in db.-->
                <input type="text" class="layui-input layui-hide id" name="id">

                <div class="layui-form-item magt3">
                    <label class="layui-form-label">考试名:</label>
                    <div class="layui-input-block">
                        <input type="text" class="layui-input examName layui-disabled" disabled name="examName" required lay-verify="required">
                    </div>
                </div>


                <div class="layui-form-item magt3">
                    <label class="layui-form-label">考试时长:</label>
                    <div class="layui-input-block">
                        <input type="text" name="examTime" class="layui-input examTime layui-disabled" disabled required lay-verify="required">
                    </div>
                </div>

                <div class="layui-form-item magt3">
                    <label class="layui-form-label">考试状态:</label>
                    <div class="layui-input-block">
                        <input type="text" name="examStatus" id="examStatus" class="layui-input examStatus layui-disabled" disabled required
                               lay-verify="required">
                    </div>
                </div>
                <div class="layui-form-item magt3">
                    <label class="layui-form-label">考试剩余时间:</label>
                    <div class="layui-input-block">
                        <input type="text" name="residualTime" id="residualTime" class="layui-input residualTime layui-disabled" disabled required
                               lay-verify="required">
                    </div>
                </div>


                <div class="layui-form-item magt3">
                    <label class="layui-form-label">及格分数:</label>
                    <div class="layui-input-block">
                        <input type="text" name="passScore" class="layui-input passScore layui-disabled" disabled required
                               lay-verify="required">
                    </div>
                </div>
                <div class="layui-form-item magt3">
                    <label class="layui-form-label">开闭卷:</label>
                    <div class="layui-input-block">
                        <input type="text" name="openOrClose" class="layui-input openOrClose layui-disabled" disabled required
                               lay-verify="required">
                    </div>
                </div>
                <br>
                在线人数:<span id="peopel">430</span><br>
                请选择要计算的日期：
                <div class="layui-inline">
                    <input type="text" class="layui-input" id="test1" value="">
                </div>

                <blockquote class="layui-elem-quote" style="margin-top: 10px;">
                    <div id="test2"></div>
                </blockquote>


            </div>
        </div>

    </div>
</form>
<script>
    layui.use(['layer','element','jquery','form','util', 'laydate'],function () {
        var $,element,form,util,laydate,layer;
        util = layui.util;
        laydate = layui.laydate;
        form =layui.form;
        layer = layui.layer;
        $=layui.jquery;
        element = layui.element;
        $(function(){
            function loadexamCurrent(){
                $.ajax({
                    type:"POST",
                    url:'/exam/queryCurrentExamInformation.do',
                    data:{},
                    dataType:'json',
                    contentType: "application/json;charset=utf-8;",
                    success:function(res){
                        if(res && res.code===0){
                            var menuHtml="";
                            var obj = eval("("+JSON.stringify(res.data)+")");

                            $('.examName').val(obj[0].examName);
                            $('.examTime').val(obj[0].examTime+"分钟");

                            $('.examStatus').val('正在考试...');
                            $('.examStatus').css('color','red')
                            $('.passScore').val(obj[0].passScore+"分");
                            $('.residualTime').val(layui.util.toDateString(obj[0].examEndTime, 'yyyy-MM-dd HH:mm:ss'));
                            $('.test1').val(layui.util.toDateString(obj[0].examEndTime, 'yyyy-MM-dd HH:mm:ss'));


                            /*0：闭卷 ； 1：开卷*/
                            if(obj[0].openOrClose === 0){
                                $('.openOrClose').val('闭卷');
                            }
                            if(obj[0].openOrClose !== 0){
                                $('.openOrClose').val("开卷");
                            }

                          /*  var examEndTime = layui.util.toDateString(obj[0].examEndTime, 'yyyy-MM-dd HH:mm:ss');
                            var TimebeforeAndafter=new Array(examEndTime.split(" "));
                            var Timebefore = new Array(TimebeforeAndafter[0].split("-"));
                            var Timeafter =new Array(TimebeforeAndafter[1].split(":"));

                            var y =parseInt(Timebefore[0]);
                            var M =parseInt(Timebefore[1]-1);
                            var d =parseInt(Timebefore[2]);
                            var H =parseInt(Timeafter[0]);
                            var m =parseInt(Timeafter[1]);
                            var s =parseInt(Timeafter[2]);*/

                            /*setCountdown(y,M,d,H,m,s);*/


                            //倒计时
                            var thisTimer, setCountdown = function(y, M, d, H, m, s){
                                var endTime = new Date(y, M||0, d||1, H||0, m||0, s||0) //结束日期
                                    ,serverTime = new Date(); //假设为当前服务器时间，这里采用的是本地时间，实际使用一般是取服务端的

                                clearTimeout(thisTimer);
                                util.countdown(endTime, serverTime, function(date, serverTime, timer){
                                    var str = date[0] + '天' + date[1] + '时' +  date[2] + '分' + date[3] + '秒';
                                    lay('#test2').html(str);
                                    thisTimer = timer;
                                });
                            };
                         /*   alert(layui.util.toDateString(obj[0].examEndTime, 'yyyy-MM-dd HH:mm:ss'));*/

                            setCountdown(layui.util.toDateString(obj[0].examEndTime, 'yyyy-MM-dd HH:mm:ss'));

                            laydate.render({
                                elem: '#test1'
                                ,type: 'datetime'
                                ,done: function(value, date){
                                    setCountdown(date.year, date.month - 1, date.date, date.hours, date.minutes, date.seconds);
                                }
                            });

                        }
                    }
                })
            };
            loadexamCurrent();

            var setInt=setInterval(function () {
                $.ajax({
                    url : "/exam/studentSize.do",
                    type : "get",
                    success : function(data){
                        $("#peopel").text(data);
                    }
                });
            },2000);
        })
    });

   /* .val(layui.util.toDateString(original_data.examEndTime, 'yyyy-MM-dd HH:mm:ss'));*/

</script>

</body>
</html>